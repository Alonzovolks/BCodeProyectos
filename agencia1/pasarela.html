<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasarela de Pagos - Andean Explorers</title>
    <meta name="description" content="Proceso de pago seguro para reservar tu tour con Andean Explorers">
    <meta name="keywords" content="pago, reserva, tour, Camino Inca, Machu Picchu, PerÃº">
    <meta name="author" content="Andean Explorers">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’³</text></svg>">
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Estilos personalizados */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .andes-logo {
            position: relative;
            width: 100px;
            height: 60px;
        }
        
        .andes-logo:before,
        .andes-logo:after {
            position: absolute;
            content: "";
            width: 50px;
            height: 60px;
            background: #2c3e50;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        
        .andes-logo:before {
            left: 0;
            transform: translateX(10px);
        }
        
        .andes-logo:after {
            left: 50px;
            transform: translateX(-10px);
        }
        
        .bg-primary {
            background-color: #2c3e50;
        }
        
        .bg-secondary {
            background-color: #e74c3c;
        }
        
        .text-primary {
            color: #2c3e50;
        }
        
        .text-secondary {
            color: #e74c3c;
        }
        
        /* Estilos para el formulario de Stripe */
        .StripeElement {
            box-sizing: border-box;
            height: 40px;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background-color: white;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        .StripeElement--focus {
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        .StripeElement--invalid {
            border-color: #dc3545;
        }
        
        .StripeElement--webkit-autofill {
            background-color: #fefde5 !important;
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .flex-col-mobile {
                flex-direction: column;
            }
            
            .w-full-mobile {
                width: 100% !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navbar -->
    <nav class="bg-white py-4 shadow-md">
        <div class="container mx-auto px-4 flex items-center justify-between">
            <a href="../index.html" class="flex items-center space-x-2">
                <div class="andes-logo"></div>
                <span class="text-2xl font-bold text-primary">Andean Explorers</span>
            </a>
            <div class="text-lg font-medium text-primary">
                Pasarela de Pagos
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Progress Steps -->
            <div class="flex justify-between mb-8 relative">
                <div class="flex flex-col items-center z-10">
                    <div class="w-10 h-10 rounded-full bg-secondary flex items-center justify-center text-white font-bold mb-2">1</div>
                    <span class="text-sm font-medium text-secondary">Resumen</span>
                </div>
                <div class="flex flex-col items-center z-10">
                    <div class="w-10 h-10 rounded-full bg-secondary flex items-center justify-center text-white font-bold mb-2">2</div>
                    <span class="text-sm font-medium text-secondary">Pago</span>
                </div>
                <div class="flex flex-col items-center z-10">
                    <div class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 font-bold mb-2">3</div>
                    <span class="text-sm font-medium text-gray-500">ConfirmaciÃ³n</span>
                </div>
                <div class="absolute top-5 left-0 right-0 h-1 bg-gray-200 -z-0">
                    <div class="h-1 bg-secondary w-1/2"></div>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-8">
                <!-- Resumen del Pedido -->
                <div class="w-full md:w-1/2 bg-white rounded-lg shadow-md p-6 fade-in">
                    <h2 class="text-xl font-bold text-primary mb-4 flex items-center">
                        <i class="fas fa-shopping-cart text-secondary mr-2"></i> Resumen de tu Reserva
                    </h2>
                    
                    <div class="border-b pb-4 mb-4">
                        <h3 class="font-semibold text-lg text-primary mb-2">Camino Inca 4 DÃ­as</h3>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Precio por persona:</span>
                            <span class="font-medium" id="precio-unitario">$650.00</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="personas" class="block text-gray-700 mb-2">NÃºmero de Personas:</label>
                        <select id="personas" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent">
                            <option value="1">1 persona</option>
                            <option value="2">2 personas</option>
                            <option value="3">3 personas</option>
                            <option value="4">4 personas</option>
                            <option value="5">5 personas</option>
                            <option value="6">6 personas</option>
                            <option value="7">7 personas</option>
                            <option value="8">8 personas</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Fecha del Tour:</label>
                        <input type="date" id="fecha-tour" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent" min="">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">MÃ©todo de Pago:</label>
                        <div class="flex space-x-4">
                            <button class="p-2 border rounded-md flex-1 text-center bg-white hover:bg-gray-50 focus:ring-2 focus:ring-secondary">
                                <i class="fab fa-cc-visa text-blue-600 text-2xl"></i>
                            </button>
                            <button class="p-2 border rounded-md flex-1 text-center bg-white hover:bg-gray-50 focus:ring-2 focus:ring-secondary">
                                <i class="fab fa-cc-mastercard text-red-600 text-2xl"></i>
                            </button>
                            <button class="p-2 border rounded-md flex-1 text-center bg-white hover:bg-gray-50 focus:ring-2 focus:ring-secondary">
                                <i class="fab fa-cc-amex text-blue-500 text-2xl"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">Subtotal:</span>
                            <span class="font-medium" id="subtotal">$650.00</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">Impuestos (10%):</span>
                            <span class="font-medium" id="impuestos">$65.00</span>
                        </div>
                        <div class="flex justify-between font-bold text-lg text-primary">
                            <span>Total:</span>
                            <span id="total">$715.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- Formulario de Pago -->

                <div class="w-full md:w-1/2 bg-white rounded-lg shadow-md p-6 fade-in" style="animation-delay: 0.2s;">
                    <h2 class="text-xl font-bold text-primary mb-4 flex items-center">
                        <i class="fas fa-credit-card text-secondary mr-2"></i> InformaciÃ³n de Pago
                    </h2>
                    
                    <form id="payment-form" class="space-y-4">
                        <div>
                            <label for="name" class="block text-gray-700 mb-2">Nombre en la Tarjeta</label>
                            <input type="text" id="name" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent" placeholder="Nombre como aparece en la tarjeta" required>
                        </div>
                        
                        <div>
                            <label for="email" class="block text-gray-700 mb-2">Correo ElectrÃ³nico</label>
                            <input type="email" id="email" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent" placeholder="tu@email.com" required>
                        </div>
                        
                        <div>
                            <label for="phone" class="block text-gray-700 mb-2">TelÃ©fono</label>
                            <input type="tel" id="phone" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-secondary focus:border-transparent" placeholder="+51 123 456 789" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Detalles de la Tarjeta</label>
                            <div id="card-element" class="p-2 border rounded-md">
                                <!-- Stripe Card Element will be inserted here -->
                            </div>
                            <div id="card-errors" role="alert" class="text-red-500 text-sm mt-2"></div>
                        </div>
                        
                        <div class="pt-4">
                            <button type="submit" id="submit-button" class="w-full bg-secondary hover:bg-red-600 text-white font-bold py-3 px-4 rounded-md transition duration-300 flex items-center justify-center">
                                <span id="button-text">Pagar $715.00</span>
                                <span id="spinner" class="hidden ml-2">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </span>
                            </button>
                        </div>
                        
                        <div class="text-xs text-gray-500 mt-4">
                            <p>Tu informaciÃ³n de pago estÃ¡ protegida con encriptaciÃ³n de 256-bit SSL. No almacenamos los detalles de tu tarjeta.</p>
                            <div class="flex justify-center mt-2 space-x-4">
                                <i class="fab fa-cc-stripe text-purple-600 text-2xl"></i>
                                <i class="fas fa-lock text-green-500 text-xl"></i>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- InformaciÃ³n Adicional -->
            <div class="bg-white rounded-lg shadow-md p-6 mt-8 fade-in" style="animation-delay: 0.4s;">
                <h2 class="text-xl font-bold text-primary mb-4 flex items-center">
                    <i class="fas fa-info-circle text-secondary mr-2"></i> InformaciÃ³n Importante
                </h2>
                
                <div class="space-y-4">
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">PolÃ­tica de CancelaciÃ³n</h3>
                            <p class="text-gray-600 text-sm">Cancelaciones con mÃ¡s de 30 dÃ­as de anticipaciÃ³n: reembolso del 90%. Entre 15-30 dÃ­as: reembolso del 50%. Menos de 15 dÃ­as: no reembolsable.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">Seguridad de Pago</h3>
                            <p class="text-gray-600 text-sm">Utilizamos Stripe, una de las plataformas de pago mÃ¡s seguras del mundo, para procesar tus transacciones.</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">ConfirmaciÃ³n Inmediata</h3>
                            <p class="text-gray-600 text-sm">RecibirÃ¡s un correo electrÃ³nico de confirmaciÃ³n con los detalles de tu reserva inmediatamente despuÃ©s del pago.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 Andean Explorers. Todos los derechos reservados.</p>
            <div class="flex justify-center space-x-4 mt-4">
                <a href="#" class="hover:text-white"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="hover:text-white"><i class="fab fa-instagram"></i></a>
                <a href="#" class="hover:text-white"><i class="fab fa-twitter"></i></a>
                <a href="#" class="hover:text-white"><i class="fab fa-whatsapp"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // ConfiguraciÃ³n inicial
        document.addEventListener('DOMContentLoaded', function() {
            // Obtener parÃ¡metros de la URL
            const urlParams = new URLSearchParams(window.location.search);
            const precio = urlParams.get('precio') || 650;
            const tour = urlParams.get('tour') || 'Camino Inca 4 DÃ­as';
            
            // Establecer valores iniciales
            document.getElementById('precio-unitario').textContent = `$${precio.toLocaleString('en-US', {minimumFractionDigits: 22})}`;
            document.title = `Pago - ${tour} | Andean Explorers`;
            
            // Configurar fecha mÃ­nima (hoy + 3 dÃ­as)
            const today = new Date();
            const minDate = new Date();
            minDate.setDate(today.getDate() + 3);
            document.getElementById('fecha-tour').min = minDate.toISOString().split('T')[0];
            
            // Calcular total inicial
            calcularTotal();
            
            // Escuchar cambios en el nÃºmero de personas
            document.getElementById('personas').addEventListener('change', calcularTotal);
        });
        
        // FunciÃ³n para calcular el total
        function calcularTotal() {
            const precioUnitario = 650; // PodrÃ­amos obtenerlo del elemento si es dinÃ¡mico
            const personas = parseInt(document.getElementById('personas').value);
            const subtotal = precioUnitario * personas;
            const impuestos = subtotal * 0.10;
            const total = subtotal + impuestos;
            
            document.getElementById('subtotal').textContent = `$${subtotal.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('impuestos').textContent = `$${impuestos.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('total').textContent = `$${total.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('button-text').textContent = `Pagar $${total.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
        }
        
        // ConfiguraciÃ³n de Stripe
                // ConfiguraciÃ³n de Stripe
                const stripe = Stripe(''); // Dejamos la clave vacÃ­a como indicaste
        
        // Crear elementos de Stripe
        const elements = stripe.elements();
        const cardElement = elements.create('card', {
            style: {
                base: {
                    fontSize: '16px',
                    color: '#32325d',
                    '::placeholder': {
                        color: '#aab7c4'
                    }
                },
                invalid: {
                    color: '#dc3545',
                    iconColor: '#dc3545'
                               }
            }
        });
        
        cardElement.mount('#card-element');
        
        // Manejar errores de validaciÃ³n en tiempo real
        cardElement.addEventListener('change', function(event) {
            const displayError = document.getElementById('card-errors');
            if (event.error) {
                displayError.textContent = event.error.message;
            } else {
                displayError.textContent = '';
            }
        });
        
        // Manejar el envÃ­o del formulario
        const form = document.getElementById('payment-form');
        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            
            // Deshabilitar el botÃ³n de enviar
            const submitButton = document.getElementById('submit-button');
            submitButton.disabled = true;
            document.getElementById('spinner').classList.remove('hidden');
            document.getElementById('button-text').textContent = 'Procesando pago...';
            
            // Obtener datos del formulario
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const personas = document.getElementById('personas').value;
            const fechaTour = document.getElementById('fecha-tour').value;
            
            // Crear token de pago con Stripe
            const { token, error } = await stripe.createToken(cardElement, {
                name: name
            });
            
            if (error) {
                // Mostrar error al usuario
                const errorElement = document.getElementById('card-errors');
                errorElement.textContent = error.message;
                
                // Habilitar el botÃ³n de nuevo
                submitButton.disabled = false;
                document.getElementById('spinner').classList.add('hidden');
                document.getElementById('button-text').textContent = `Pagar ${document.getElementById('total').textContent}`;
            } else {
                // Enviar el token al servidor (simulado aquÃ­)
                // En una implementaciÃ³n real, harÃ­as una llamada AJAX a tu backend
                console.log('Token creado:', token.id);
                
                // Simular procesamiento del pago
                setTimeout(function() {
                    // Redirigir a pÃ¡gina de confirmaciÃ³n
                    window.location.href = 'confirmacion.html?tour=Camino+Inca+4+DÃ­as&personas=' + personas + '&fecha=' + fechaTour + '&total=' + document.getElementById('total').textContent;
                }, 2000);
            }
        });
        
        // ValidaciÃ³n adicional del formulario
        form.addEventListener('input', function() {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const submitButton = document.getElementById('submit-button');
            
            // ValidaciÃ³n bÃ¡sica
            if (name.trim() !== '' && email.trim() !== '' && phone.trim() !== '') {
                submitButton.disabled = false;
                submitButton.classList.remove('opacity-50');
            } else {
                submitButton.disabled = true;
                submitButton.classList.add('opacity-50');
            }
        });
    </script>
</body>
</html>
